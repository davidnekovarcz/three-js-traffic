<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Test</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #00ff00; 
        }
        .success { color: #00ff00; }
        .error { color: #ff4444; }
        .step { margin: 5px 0; }
        #canvas-container { 
            margin-top: 20px; 
            border: 1px solid #444; 
            min-height: 200px; 
        }
    </style>
</head>
<body>
    <h1>Traffic Run Browser Test</h1>
    <div id="log"></div>
    <div id="canvas-container">
        <p>Game canvas will appear here...</p>
    </div>
    
    <script type="module">
        const log = document.getElementById('log');
        let step = 1;
        
        function logMessage(message, isError = false) {
            const div = document.createElement('div');
            div.className = `step ${isError ? 'error' : 'success'}`;
            div.textContent = `${step++}. ${message}`;
            log.appendChild(div);
            console.log(message);
        }
        
        async function runBrowserTest() {
            try {
                logMessage('Starting browser test...');
                
                // Test Three.js import
                logMessage('Loading Three.js...');
                const THREE = await import('three');
                if (!THREE.Scene) throw new Error('Three.js Scene not available');
                logMessage('‚úì Three.js loaded');
                
                // Test core modules
                logMessage('Loading EventBus...');
                const { eventBus, GameEvents } = await import('../src/core/EventBus.js');
                eventBus.emit('test', 'hello');
                logMessage('‚úì EventBus loaded');
                
                logMessage('Loading Config...');
                const { gameConfig, loadEnvironmentConfig } = await import('../src/core/Config.js');
                const config = loadEnvironmentConfig();
                logMessage('‚úì Config loaded');
                
                logMessage('Loading Logger...');
                const { createLogger } = await import('../src/core/Logger.js');
                const logger = createLogger('BrowserTest');
                logger.info('Browser test running');
                logMessage('‚úì Logger loaded');
                
                logMessage('Loading Renderer...');
                const { GameRenderer } = await import('../src/core/Renderer.js');
                const renderer = new GameRenderer();
                logMessage('‚úì Renderer created');
                
                // Test Game class
                logMessage('Loading Game class...');
                const { TrafficRunGame } = await import('../src/core/Game.js');
                logMessage('‚úì Game class loaded');
                
                logMessage('Creating game instance...');
                const game = new TrafficRunGame();
                logMessage('‚úì Game instance created');
                
                logMessage('Initializing game...');
                await game.init();
                logMessage('‚úì Game initialized successfully!');
                
                logMessage('üéâ ALL TESTS PASSED! Game is working!');
                
                // Try to start the game
                logMessage('Starting game...');
                game.start();
                logMessage('‚úì Game started! Check the page for the game canvas.');
                
            } catch (error) {
                logMessage(`‚ùå Error: ${error.message}`, true);
                console.error('Full error:', error);
                console.error('Stack trace:', error.stack);
            }
        }
        
        // Wait for DOM to be ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', runBrowserTest);
        } else {
            runBrowserTest();
        }
    </script>
</body>
</html>